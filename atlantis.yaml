version: 2
projects:
  - name: personal
    dir: .
    workflow: personal-workflow
    autoplan:
      when_modified: ["*.conf", "*.tf*"]
workflows:
  personal-workflow:
    plan:
      steps:
        - run: rm -rf .terraform
        - init:
            extra_args: [-backend-config=config/personal.conf]
        - run: terraform plan -var-file=config/personal.tfvars -out $PLANFILE
    apply:
      steps:
        - run: terraform apply $PLANFILE
